{"version":3,"sources":["../../es6/util/Immediate.js"],"names":[],"mappings":"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","file":"Immediate.js","sourcesContent":["/**\nAll credit for this helper goes to http://github.com/YuzuJS/setImmediate\n*/\nimport { root as JSGlobal } from './root';\nexport let Immediate = {\n    setImmediate: (x) => { return 0; },\n    clearImmediate: (id) => { }\n};\nif (JSGlobal && JSGlobal.setImmediate) {\n    Immediate.setImmediate = JSGlobal.setImmediate;\n    Immediate.clearImmediate = JSGlobal.clearImmediate;\n}\nelse {\n    Immediate = (function (global, Immediate) {\n        let nextHandle = 1, // Spec says greater than zero\n        tasksByHandle = {}, currentlyRunningATask = false, doc = global.document, setImmediate;\n        // Don't get fooled by e.g. browserify environments.\n        if ({}.toString.call(global.process) === '[object process]') {\n            // For Node.js before 0.9\n            setImmediate = installNextTickImplementation();\n        }\n        else if (canUsePostMessage()) {\n            // For non-IE10 modern browsers\n            setImmediate = installPostMessageImplementation();\n        }\n        else if (global.MessageChannel) {\n            // For web workers, where supported\n            setImmediate = installMessageChannelImplementation();\n        }\n        else if (doc && 'onreadystatechange' in doc.createElement('script')) {\n            // For IE 6â€“8\n            setImmediate = installReadyStateChangeImplementation();\n        }\n        else {\n            // For older browsers\n            setImmediate = installSetTimeoutImplementation();\n        }\n        Immediate.setImmediate = setImmediate;\n        Immediate.clearImmediate = clearImmediate;\n        return Immediate;\n        function clearImmediate(handle) {\n            delete tasksByHandle[handle];\n        }\n        function addFromSetImmediateArguments(args) {\n            tasksByHandle[nextHandle] = partiallyApplied.apply(undefined, args);\n            return nextHandle++;\n        }\n        // This function accepts the same arguments as setImmediate, but\n        // returns a function that requires no arguments.\n        function partiallyApplied(handler, ...args) {\n            return function () {\n                if (typeof handler === 'function') {\n                    handler.apply(undefined, args);\n                }\n                else {\n                    (new Function('' + handler))();\n                }\n            };\n        }\n        function runIfPresent(handle) {\n            // From the spec: 'Wait until any invocations of this algorithm started before this one have completed.'\n            // So if we're currently running a task, we'll need to delay this invocation.\n            if (currentlyRunningATask) {\n                // Delay by doing a setTimeout. setImmediate was tried instead, but in Firefox 7 it generated a\n                // 'too much recursion' error.\n                setTimeout(partiallyApplied(runIfPresent, handle), 0);\n            }\n            else {\n                let task = tasksByHandle[handle];\n                if (task) {\n                    currentlyRunningATask = true;\n                    try {\n                        task();\n                    }\n                    finally {\n                        clearImmediate(handle);\n                        currentlyRunningATask = false;\n                    }\n                }\n            }\n        }\n        function installNextTickImplementation() {\n            return function setImmediate() {\n                let handle = addFromSetImmediateArguments(arguments);\n                global.process.nextTick(partiallyApplied(runIfPresent, handle));\n                return handle;\n            };\n        }\n        function canUsePostMessage() {\n            // The test against `importScripts` prevents this implementation from being installed inside a web worker,\n            // where `global.postMessage` means something completely different and can't be used for this purpose.\n            if (global.postMessage && !global.importScripts) {\n                let postMessageIsAsynchronous = true;\n                let oldOnMessage = global.onmessage;\n                global.onmessage = function () {\n                    postMessageIsAsynchronous = false;\n                };\n                global.postMessage('', '*');\n                global.onmessage = oldOnMessage;\n                return postMessageIsAsynchronous;\n            }\n        }\n        function installPostMessageImplementation() {\n            // Installs an event handler on `global` for the `message` event: see\n            // * https://developer.mozilla.org/en/DOM/window.postMessage\n            // * http://www.whatwg.org/specs/web-apps/current-work/multipage/comms.html#crossDocumentMessages\n            let messagePrefix = 'setImmediate$' + Math.random() + '$';\n            let onGlobalMessage = function (event) {\n                if (event.source === global &&\n                    typeof event.data === 'string' &&\n                    event.data.indexOf(messagePrefix) === 0) {\n                    runIfPresent(+event.data.slice(messagePrefix.length));\n                }\n            };\n            if (global.addEventListener) {\n                global.addEventListener('message', onGlobalMessage, false);\n            }\n            else {\n                global.attachEvent('onmessage', onGlobalMessage);\n            }\n            return function setImmediate() {\n                let handle = addFromSetImmediateArguments(arguments);\n                global.postMessage(messagePrefix + handle, '*');\n                return handle;\n            };\n        }\n        function installMessageChannelImplementation() {\n            let channel = new MessageChannel();\n            channel.port1.onmessage = function (event) {\n                let handle = event.data;\n                runIfPresent(handle);\n            };\n            return function setImmediate() {\n                let handle = addFromSetImmediateArguments(arguments);\n                channel.port2.postMessage(handle);\n                return handle;\n            };\n        }\n        function installReadyStateChangeImplementation() {\n            let html = doc.documentElement;\n            return function setImmediate() {\n                let handle = addFromSetImmediateArguments(arguments);\n                // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n                // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n                let script = doc.createElement('script');\n                script.onreadystatechange = function () {\n                    runIfPresent(handle);\n                    script.onreadystatechange = null;\n                    html.removeChild(script);\n                    script = null;\n                };\n                html.appendChild(script);\n                return handle;\n            };\n        }\n        function installSetTimeoutImplementation() {\n            return function setImmediate() {\n                let handle = addFromSetImmediateArguments(arguments);\n                setTimeout(partiallyApplied(runIfPresent, handle), 0);\n                return handle;\n            };\n        }\n    }(JSGlobal, Immediate));\n}\n//# sourceMappingURL=Immediate.js.map"]}