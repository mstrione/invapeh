{"version":3,"sources":["../../es6/operators/windowTime.js"],"names":[],"mappings":"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","file":"windowTime.js","sourcesContent":["import Subscriber from '../Subscriber';\nimport Subject from '../Subject';\nimport nextTick from '../schedulers/nextTick';\nexport default function windowTime(windowTimeSpan, windowCreationInterval = null, scheduler = nextTick) {\n    return this.lift(new WindowTimeOperator(windowTimeSpan, windowCreationInterval, scheduler));\n}\nclass WindowTimeOperator {\n    constructor(windowTimeSpan, windowCreationInterval, scheduler) {\n        this.windowTimeSpan = windowTimeSpan;\n        this.windowCreationInterval = windowCreationInterval;\n        this.scheduler = scheduler;\n    }\n    call(subscriber) {\n        return new WindowTimeSubscriber(subscriber, this.windowTimeSpan, this.windowCreationInterval, this.scheduler);\n    }\n}\nclass WindowTimeSubscriber extends Subscriber {\n    constructor(destination, windowTimeSpan, windowCreationInterval, scheduler) {\n        super(destination);\n        this.windowTimeSpan = windowTimeSpan;\n        this.windowCreationInterval = windowCreationInterval;\n        this.scheduler = scheduler;\n        this.windows = [];\n        if (windowCreationInterval !== null && windowCreationInterval >= 0) {\n            let window = this.openWindow();\n            const closeState = { subscriber: this, window, context: null };\n            const creationState = { windowTimeSpan, windowCreationInterval, subscriber: this, scheduler };\n            this.add(scheduler.schedule(dispatchWindowClose, windowTimeSpan, closeState));\n            this.add(scheduler.schedule(dispatchWindowCreation, windowCreationInterval, creationState));\n        }\n        else {\n            let window = this.openWindow();\n            const timeSpanOnlyState = { subscriber: this, window, windowTimeSpan };\n            this.add(scheduler.schedule(dispatchWindowTimeSpanOnly, windowTimeSpan, timeSpanOnlyState));\n        }\n    }\n    _next(value) {\n        const windows = this.windows;\n        const len = windows.length;\n        for (let i = 0; i < len; i++) {\n            windows[i].next(value);\n        }\n    }\n    _error(err) {\n        const windows = this.windows;\n        while (windows.length > 0) {\n            windows.shift().error(err);\n        }\n        this.destination.error(err);\n    }\n    _complete() {\n        const windows = this.windows;\n        while (windows.length > 0) {\n            windows.shift().complete();\n        }\n        this.destination.complete();\n    }\n    openWindow() {\n        let window = new Subject();\n        this.windows.push(window);\n        this.destination.next(window);\n        return window;\n    }\n    closeWindow(window) {\n        window.complete();\n        const windows = this.windows;\n        windows.splice(windows.indexOf(window), 1);\n    }\n}\nfunction dispatchWindowTimeSpanOnly(state) {\n    const { subscriber, windowTimeSpan, window } = state;\n    if (window) {\n        window.complete();\n    }\n    state.window = subscriber.openWindow();\n    this.schedule(state, windowTimeSpan);\n}\nfunction dispatchWindowCreation(state) {\n    let { windowTimeSpan, subscriber, scheduler, windowCreationInterval } = state;\n    let window = subscriber.openWindow();\n    let action = this;\n    let context = { action, subscription: null };\n    const timeSpanState = { subscriber, window, context };\n    context.subscription = scheduler.schedule(dispatchWindowClose, windowTimeSpan, timeSpanState);\n    action.add(context.subscription);\n    action.schedule(state, windowCreationInterval);\n}\nfunction dispatchWindowClose({ subscriber, window, context }) {\n    if (context && context.action && context.subscription) {\n        context.action.remove(context.subscription);\n    }\n    subscriber.closeWindow(window);\n}\n//# sourceMappingURL=windowTime.js.map"]}