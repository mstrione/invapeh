{"version":3,"sources":["../../es6/operators/timeoutWith.js"],"names":[],"mappings":"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","file":"timeoutWith.js","sourcesContent":["import immediate from '../schedulers/immediate';\nimport isDate from '../util/isDate';\nimport OuterSubscriber from '../OuterSubscriber';\nimport subscribeToResult from '../util/subscribeToResult';\nexport default function timeoutWith(due, withObservable, scheduler = immediate) {\n    let absoluteTimeout = isDate(due);\n    let waitFor = absoluteTimeout ? (+due - scheduler.now()) : due;\n    return this.lift(new TimeoutWithOperator(waitFor, absoluteTimeout, withObservable, scheduler));\n}\nclass TimeoutWithOperator {\n    constructor(waitFor, absoluteTimeout, withObservable, scheduler) {\n        this.waitFor = waitFor;\n        this.absoluteTimeout = absoluteTimeout;\n        this.withObservable = withObservable;\n        this.scheduler = scheduler;\n    }\n    call(subscriber) {\n        return new TimeoutWithSubscriber(subscriber, this.absoluteTimeout, this.waitFor, this.withObservable, this.scheduler);\n    }\n}\nclass TimeoutWithSubscriber extends OuterSubscriber {\n    constructor(destination, absoluteTimeout, waitFor, withObservable, scheduler) {\n        super(destination);\n        this.absoluteTimeout = absoluteTimeout;\n        this.waitFor = waitFor;\n        this.withObservable = withObservable;\n        this.scheduler = scheduler;\n        this.timeoutSubscription = undefined;\n        this.timedOut = false;\n        this.index = 0;\n        this._previousIndex = 0;\n        this._hasCompleted = false;\n        this.scheduleTimeout();\n    }\n    get previousIndex() {\n        return this._previousIndex;\n    }\n    get hasCompleted() {\n        return this._hasCompleted;\n    }\n    static dispatchTimeout(state) {\n        const source = state.subscriber;\n        const currentIndex = state.index;\n        if (!source.hasCompleted && source.previousIndex === currentIndex) {\n            source.handleTimeout();\n        }\n    }\n    scheduleTimeout() {\n        let currentIndex = this.index;\n        const timeoutState = { subscriber: this, index: currentIndex };\n        this.scheduler.schedule(TimeoutWithSubscriber.dispatchTimeout, this.waitFor, timeoutState);\n        this.index++;\n        this._previousIndex = currentIndex;\n    }\n    _next(value) {\n        if (!this.timedOut) {\n            this.destination.next(value);\n            if (!this.absoluteTimeout) {\n                this.scheduleTimeout();\n            }\n        }\n    }\n    _error(err) {\n        if (!this.timedOut) {\n            this.destination.error(err);\n            this._hasCompleted = true;\n        }\n    }\n    _complete() {\n        if (!this.timedOut) {\n            this.destination.complete();\n            this._hasCompleted = true;\n        }\n    }\n    handleTimeout() {\n        const withObservable = this.withObservable;\n        this.timedOut = true;\n        this.add(this.timeoutSubscription = subscribeToResult(this, withObservable));\n    }\n}\n//# sourceMappingURL=timeoutWith.js.map"]}