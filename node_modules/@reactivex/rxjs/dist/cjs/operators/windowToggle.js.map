{"version":3,"sources":["../../es6/operators/windowToggle.js"],"names":[],"mappings":"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","file":"windowToggle.js","sourcesContent":["import Subscriber from '../Subscriber';\nimport Subject from '../Subject';\nimport Subscription from '../Subscription';\nimport tryCatch from '../util/tryCatch';\nimport { errorObject } from '../util/errorObject';\nexport default function windowToggle(openings, closingSelector) {\n    return this.lift(new WindowToggleOperator(openings, closingSelector));\n}\nclass WindowToggleOperator {\n    constructor(openings, closingSelector) {\n        this.openings = openings;\n        this.closingSelector = closingSelector;\n    }\n    call(subscriber) {\n        return new WindowToggleSubscriber(subscriber, this.openings, this.closingSelector);\n    }\n}\nclass WindowToggleSubscriber extends Subscriber {\n    constructor(destination, openings, closingSelector) {\n        super(destination);\n        this.openings = openings;\n        this.closingSelector = closingSelector;\n        this.contexts = [];\n        this.add(this.openings._subscribe(new WindowToggleOpeningsSubscriber(this)));\n    }\n    _next(value) {\n        const contexts = this.contexts;\n        const len = contexts.length;\n        for (let i = 0; i < len; i++) {\n            contexts[i].window.next(value);\n        }\n    }\n    _error(err) {\n        const contexts = this.contexts;\n        while (contexts.length > 0) {\n            contexts.shift().window.error(err);\n        }\n        this.destination.error(err);\n    }\n    _complete() {\n        const contexts = this.contexts;\n        while (contexts.length > 0) {\n            const context = contexts.shift();\n            context.window.complete();\n            context.subscription.unsubscribe();\n        }\n        this.destination.complete();\n    }\n    openWindow(value) {\n        const closingSelector = this.closingSelector;\n        let closingNotifier = tryCatch(closingSelector)(value);\n        if (closingNotifier === errorObject) {\n            this.error(closingNotifier.e);\n        }\n        else {\n            let context = {\n                window: new Subject(),\n                subscription: new Subscription()\n            };\n            this.contexts.push(context);\n            this.destination.next(context.window);\n            const subscriber = new WindowClosingNotifierSubscriber(this, context);\n            const subscription = closingNotifier._subscribe(subscriber);\n            this.add(context.subscription.add(subscription));\n        }\n    }\n    closeWindow(context) {\n        const { window, subscription } = context;\n        const contexts = this.contexts;\n        contexts.splice(contexts.indexOf(context), 1);\n        window.complete();\n        this.remove(subscription);\n        subscription.unsubscribe();\n    }\n}\nclass WindowClosingNotifierSubscriber extends Subscriber {\n    constructor(parent, windowContext) {\n        super(null);\n        this.parent = parent;\n        this.windowContext = windowContext;\n    }\n    _next() {\n        this.parent.closeWindow(this.windowContext);\n    }\n    _error(err) {\n        this.parent.error(err);\n    }\n    _complete() {\n        this.parent.closeWindow(this.windowContext);\n    }\n}\nclass WindowToggleOpeningsSubscriber extends Subscriber {\n    constructor(parent) {\n        super();\n        this.parent = parent;\n    }\n    _next(value) {\n        this.parent.openWindow(value);\n    }\n    _error(err) {\n        this.parent.error(err);\n    }\n    _complete() {\n        // noop\n    }\n}\n//# sourceMappingURL=windowToggle.js.map"]}