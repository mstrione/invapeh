{"version":3,"sources":["../../es6/operators/retryWhen.js"],"names":[],"mappings":"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","file":"retryWhen.js","sourcesContent":["import Subscriber from '../Subscriber';\nimport Subject from '../Subject';\nimport tryCatch from '../util/tryCatch';\nimport { errorObject } from '../util/errorObject';\nexport default function retryWhen(notifier) {\n    return this.lift(new RetryWhenOperator(notifier, this));\n}\nclass RetryWhenOperator {\n    constructor(notifier, source) {\n        this.notifier = notifier;\n        this.source = source;\n    }\n    call(subscriber) {\n        return new FirstRetryWhenSubscriber(subscriber, this.notifier, this.source);\n    }\n}\nclass FirstRetryWhenSubscriber extends Subscriber {\n    constructor(destination, notifier, source) {\n        super(null);\n        this.destination = destination;\n        this.notifier = notifier;\n        this.source = source;\n        this.lastSubscription = this;\n    }\n    _next(value) {\n        this.destination.next(value);\n    }\n    error(err) {\n        if (!this.isUnsubscribed) {\n            super.unsubscribe();\n            if (!this.retryNotifications) {\n                this.errors = new Subject();\n                const notifications = tryCatch(this.notifier).call(this, this.errors);\n                if (notifications === errorObject) {\n                    this.destination.error(errorObject.e);\n                }\n                else {\n                    this.retryNotifications = notifications;\n                    const notificationSubscriber = new RetryNotificationSubscriber(this);\n                    this.notificationSubscription = notifications.subscribe(notificationSubscriber);\n                }\n            }\n            this.errors.next(err);\n        }\n    }\n    destinationError(err) {\n        this.tearDown();\n        this.destination.error(err);\n    }\n    _complete() {\n        this.destinationComplete();\n    }\n    destinationComplete() {\n        this.tearDown();\n        this.destination.complete();\n    }\n    unsubscribe() {\n        const lastSubscription = this.lastSubscription;\n        if (lastSubscription === this) {\n            super.unsubscribe();\n        }\n        else {\n            this.tearDown();\n        }\n    }\n    tearDown() {\n        super.unsubscribe();\n        this.lastSubscription.unsubscribe();\n        const notificationSubscription = this.notificationSubscription;\n        if (notificationSubscription) {\n            notificationSubscription.unsubscribe();\n        }\n    }\n    resubscribe() {\n        this.lastSubscription.unsubscribe();\n        const nextSubscriber = new MoreRetryWhenSubscriber(this);\n        this.lastSubscription = this.source.subscribe(nextSubscriber);\n    }\n}\nclass MoreRetryWhenSubscriber extends Subscriber {\n    constructor(parent) {\n        super(null);\n        this.parent = parent;\n    }\n    _next(value) {\n        this.parent.destination.next(value);\n    }\n    _error(err) {\n        this.parent.errors.next(err);\n    }\n    _complete() {\n        this.parent.destinationComplete();\n    }\n}\nclass RetryNotificationSubscriber extends Subscriber {\n    constructor(parent) {\n        super(null);\n        this.parent = parent;\n    }\n    _next(value) {\n        this.parent.resubscribe();\n    }\n    _error(err) {\n        this.parent.destinationError(err);\n    }\n    _complete() {\n        this.parent.destinationComplete();\n    }\n}\n//# sourceMappingURL=retryWhen.js.map"]}