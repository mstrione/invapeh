{"version":3,"sources":["../../es6/operators/groupBy-support.js"],"names":[],"mappings":";;;;;;;;;;6BAAyB,iBAAiB;;;;2BACnB,eAAe;;;;IACzB,oBAAoB;cAApB,oBAAoB;;AAClB,aADF,oBAAoB,GACf;8BADL,oBAAoB;;AAEzB,gCAAO,CAAC;AACR,YAAI,CAAC,6BAA6B,GAAG,KAAK,CAAC;AAC3C,YAAI,CAAC,KAAK,GAAG,CAAC,CAAC;KAClB;;AALQ,wBAAoB,WAM7B,UAAU,GAAA,oBAAC,YAAY,EAAE;AACrB,YAAI,CAAC,OAAO,GAAG,YAAY,CAAC;KAC/B;;AARQ,wBAAoB,WAS7B,WAAW,GAAA,uBAAG;AACV,YAAI,CAAC,IAAI,CAAC,cAAc,IAAI,CAAC,IAAI,CAAC,6BAA6B,EAAE;AAC7D,gBAAI,CAAC,6BAA6B,GAAG,IAAI,CAAC;AAC1C,gBAAI,IAAI,CAAC,KAAK,KAAK,CAAC,EAAE;AAClB,wCAAM,WAAW,KAAA,MAAE,CAAC;AACpB,oBAAI,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC;aAC9B;SACJ;KACJ;;WAjBQ,oBAAoB;;;;;IAmBpB,iBAAiB;cAAjB,iBAAiB;;AACf,aADF,iBAAiB,CACd,GAAG,EAAE,YAAY,EAAE,oBAAoB,EAAE;8BAD5C,iBAAiB;;AAEtB,8BAAO,CAAC;AACR,YAAI,CAAC,GAAG,GAAG,GAAG,CAAC;AACf,YAAI,CAAC,YAAY,GAAG,YAAY,CAAC;AACjC,YAAI,CAAC,oBAAoB,GAAG,oBAAoB,CAAC;KACpD;;AANQ,qBAAiB,WAO1B,UAAU,GAAA,oBAAC,UAAU,EAAE;AACnB,YAAM,YAAY,GAAG,+BAAkB,CAAC;AACxC,YAAI,IAAI,CAAC,oBAAoB,IAAI,CAAC,IAAI,CAAC,oBAAoB,CAAC,cAAc,EAAE;AACxE,wBAAY,CAAC,GAAG,CAAC,IAAI,yBAAyB,CAAC,IAAI,CAAC,oBAAoB,CAAC,CAAC,CAAC;SAC9E;AACD,oBAAY,CAAC,GAAG,CAAC,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC,CAAC;AAC1D,eAAO,YAAY,CAAC;KACvB;;WAdQ,iBAAiB;;;;;IAgBjB,yBAAyB;cAAzB,yBAAyB;;AACvB,aADF,yBAAyB,CACtB,MAAM,EAAE;8BADX,yBAAyB;;AAE9B,iCAAO,CAAC;AACR,YAAI,CAAC,MAAM,GAAG,MAAM,CAAC;AACrB,cAAM,CAAC,KAAK,EAAE,CAAC;KAClB;;;;AALQ,6BAAyB,WAMlC,WAAW,GAAA,uBAAG;AACV,YAAI,CAAC,IAAI,CAAC,MAAM,CAAC,cAAc,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE;AACrD,qCAAM,WAAW,KAAA,MAAE,CAAC;AACpB,gBAAI,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC;AACpB,gBAAI,IAAI,CAAC,MAAM,CAAC,KAAK,KAAK,CAAC,IAAI,IAAI,CAAC,MAAM,CAAC,6BAA6B,EAAE;AACtE,oBAAI,CAAC,MAAM,CAAC,WAAW,EAAE,CAAC;AAC1B,oBAAI,CAAC,MAAM,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC;aACrC;SACJ;KACJ;;WAfQ,yBAAyB","file":"groupBy-support.js","sourcesContent":["import Subscription from '../Subscription';\nimport Observable from '../Observable';\nexport class RefCountSubscription extends Subscription {\n    constructor() {\n        super();\n        this.attemptedToUnsubscribePrimary = false;\n        this.count = 0;\n    }\n    setPrimary(subscription) {\n        this.primary = subscription;\n    }\n    unsubscribe() {\n        if (!this.isUnsubscribed && !this.attemptedToUnsubscribePrimary) {\n            this.attemptedToUnsubscribePrimary = true;\n            if (this.count === 0) {\n                super.unsubscribe();\n                this.primary.unsubscribe();\n            }\n        }\n    }\n}\nexport class GroupedObservable extends Observable {\n    constructor(key, groupSubject, refCountSubscription) {\n        super();\n        this.key = key;\n        this.groupSubject = groupSubject;\n        this.refCountSubscription = refCountSubscription;\n    }\n    _subscribe(subscriber) {\n        const subscription = new Subscription();\n        if (this.refCountSubscription && !this.refCountSubscription.isUnsubscribed) {\n            subscription.add(new InnerRefCountSubscription(this.refCountSubscription));\n        }\n        subscription.add(this.groupSubject.subscribe(subscriber));\n        return subscription;\n    }\n}\nexport class InnerRefCountSubscription extends Subscription {\n    constructor(parent) {\n        super();\n        this.parent = parent;\n        parent.count++;\n    }\n    unsubscribe() {\n        if (!this.parent.isUnsubscribed && !this.isUnsubscribed) {\n            super.unsubscribe();\n            this.parent.count--;\n            if (this.parent.count === 0 && this.parent.attemptedToUnsubscribePrimary) {\n                this.parent.unsubscribe();\n                this.parent.primary.unsubscribe();\n            }\n        }\n    }\n}\n//# sourceMappingURL=groupBy-support.js.map"]}