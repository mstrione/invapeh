{"version":3,"sources":["../../es6/operators/expand-support.js"],"names":[],"mappings":"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","file":"expand-support.js","sourcesContent":["import tryCatch from '../util/tryCatch';\nimport { errorObject } from '../util/errorObject';\nimport OuterSubscriber from '../OuterSubscriber';\nimport subscribeToResult from '../util/subscribeToResult';\nexport class ExpandOperator {\n    constructor(project, concurrent = Number.POSITIVE_INFINITY) {\n        this.project = project;\n        this.concurrent = concurrent;\n    }\n    call(subscriber) {\n        return new ExpandSubscriber(subscriber, this.project, this.concurrent);\n    }\n}\nexport class ExpandSubscriber extends OuterSubscriber {\n    constructor(destination, project, concurrent = Number.POSITIVE_INFINITY) {\n        super(destination);\n        this.project = project;\n        this.concurrent = concurrent;\n        this.index = 0;\n        this.active = 0;\n        this.hasCompleted = false;\n        if (concurrent < Number.POSITIVE_INFINITY) {\n            this.buffer = [];\n        }\n    }\n    _next(value) {\n        const index = this.index++;\n        this.destination.next(value);\n        if (this.active < this.concurrent) {\n            let result = tryCatch(this.project)(value, index);\n            if (result === errorObject) {\n                this.destination.error(result.e);\n            }\n            else {\n                if (result._isScalar) {\n                    this._next(result.value);\n                }\n                else {\n                    this.active++;\n                    this.add(subscribeToResult(this, result, value, index));\n                }\n            }\n        }\n        else {\n            this.buffer.push(value);\n        }\n    }\n    _complete() {\n        this.hasCompleted = true;\n        if (this.hasCompleted && this.active === 0) {\n            this.destination.complete();\n        }\n    }\n    notifyComplete(innerSub) {\n        const buffer = this.buffer;\n        this.remove(innerSub);\n        this.active--;\n        if (buffer && buffer.length > 0) {\n            this._next(buffer.shift());\n        }\n        if (this.hasCompleted && this.active === 0) {\n            this.destination.complete();\n        }\n    }\n    notifyNext(outerValue, innerValue, outerIndex, innerIndex) {\n        this._next(innerValue);\n    }\n}\n//# sourceMappingURL=expand-support.js.map"]}