{"version":3,"sources":["../../es6/operators/bufferToggle.js"],"names":[],"mappings":"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","file":"bufferToggle.js","sourcesContent":["import Subscriber from '../Subscriber';\nimport Subscription from '../Subscription';\nimport tryCatch from '../util/tryCatch';\nimport { errorObject } from '../util/errorObject';\n/**\n * buffers values from the source by opening the buffer via signals from an observable provided to `openings`, and closing\n * and sending the buffers when an observable returned by the `closingSelector` emits.\n * @param {Observable<O>} openings An observable of notifications to start new buffers\n * @param {Function} an function, that takes the value emitted by the `openings` observable and returns an Observable, which,\n *  when it emits, signals that the associated buffer should be emitted and cleared.\n * @returns {Observable<T[]>} an observable of arrays of buffered values.\n */\nexport default function bufferToggle(openings, closingSelector) {\n    return this.lift(new BufferToggleOperator(openings, closingSelector));\n}\nclass BufferToggleOperator {\n    constructor(openings, closingSelector) {\n        this.openings = openings;\n        this.closingSelector = closingSelector;\n    }\n    call(subscriber) {\n        return new BufferToggleSubscriber(subscriber, this.openings, this.closingSelector);\n    }\n}\nclass BufferToggleSubscriber extends Subscriber {\n    constructor(destination, openings, closingSelector) {\n        super(destination);\n        this.openings = openings;\n        this.closingSelector = closingSelector;\n        this.contexts = [];\n        this.add(this.openings._subscribe(new BufferToggleOpeningsSubscriber(this)));\n    }\n    _next(value) {\n        const contexts = this.contexts;\n        const len = contexts.length;\n        for (let i = 0; i < len; i++) {\n            contexts[i].buffer.push(value);\n        }\n    }\n    _error(err) {\n        this.contexts = null;\n        this.destination.error(err);\n    }\n    _complete() {\n        const contexts = this.contexts;\n        while (contexts.length > 0) {\n            const context = contexts.shift();\n            this.destination.next(context.buffer);\n            context.subscription.unsubscribe();\n            context.buffer = null;\n        }\n        this.destination.complete();\n    }\n    openBuffer(value) {\n        const closingSelector = this.closingSelector;\n        const contexts = this.contexts;\n        let closingNotifier = tryCatch(closingSelector)(value);\n        if (closingNotifier === errorObject) {\n            const err = closingNotifier.e;\n            this.contexts = null;\n            this.destination.error(err);\n        }\n        else {\n            let context = {\n                buffer: [],\n                subscription: new Subscription()\n            };\n            contexts.push(context);\n            const subscriber = new BufferClosingNotifierSubscriber(this, context);\n            const subscription = closingNotifier._subscribe(subscriber);\n            this.add(context.subscription.add(subscription));\n        }\n    }\n    closeBuffer(context) {\n        const contexts = this.contexts;\n        if (contexts === null) {\n            return;\n        }\n        const { buffer, subscription } = context;\n        this.destination.next(buffer);\n        contexts.splice(contexts.indexOf(context), 1);\n        this.remove(subscription);\n        subscription.unsubscribe();\n    }\n}\nclass BufferClosingNotifierSubscriber extends Subscriber {\n    constructor(parent, context) {\n        super(null);\n        this.parent = parent;\n        this.context = context;\n    }\n    _next() {\n        this.parent.closeBuffer(this.context);\n    }\n    _error(err) {\n        this.parent.error(err);\n    }\n    _complete() {\n        this.parent.closeBuffer(this.context);\n    }\n}\nclass BufferToggleOpeningsSubscriber extends Subscriber {\n    constructor(parent) {\n        super(null);\n        this.parent = parent;\n    }\n    _next(value) {\n        this.parent.openBuffer(value);\n    }\n    _error(err) {\n        this.parent.error(err);\n    }\n    _complete() {\n        // noop\n    }\n}\n//# sourceMappingURL=bufferToggle.js.map"]}