{"version":3,"sources":["../../es6/operators/delay.js"],"names":[],"mappings":"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","file":"delay.js","sourcesContent":["import Subscriber from '../Subscriber';\nimport Notification from '../Notification';\nimport immediate from '../schedulers/immediate';\nimport isDate from '../util/isDate';\nexport default function delay(delay, scheduler = immediate) {\n    let absoluteDelay = isDate(delay);\n    let delayFor = absoluteDelay ? (+delay - scheduler.now()) : delay;\n    return this.lift(new DelayOperator(delayFor, scheduler));\n}\nclass DelayOperator {\n    constructor(delay, scheduler) {\n        this.delay = delay;\n        this.scheduler = scheduler;\n    }\n    call(subscriber) {\n        return new DelaySubscriber(subscriber, this.delay, this.scheduler);\n    }\n}\nclass DelaySubscriber extends Subscriber {\n    constructor(destination, delay, scheduler) {\n        super(destination);\n        this.delay = delay;\n        this.scheduler = scheduler;\n        this.queue = [];\n        this.active = false;\n        this.errored = false;\n    }\n    static dispatch(state) {\n        const source = state.source;\n        const queue = source.queue;\n        const scheduler = state.scheduler;\n        const destination = state.destination;\n        while (queue.length > 0 && (queue[0].time - scheduler.now()) <= 0) {\n            queue.shift().notification.observe(destination);\n        }\n        if (queue.length > 0) {\n            let delay = Math.max(0, queue[0].time - scheduler.now());\n            this.schedule(state, delay);\n        }\n        else {\n            source.active = false;\n        }\n    }\n    _schedule(scheduler) {\n        this.active = true;\n        this.add(scheduler.schedule(DelaySubscriber.dispatch, this.delay, {\n            source: this, destination: this.destination, scheduler: scheduler\n        }));\n    }\n    scheduleNotification(notification) {\n        if (this.errored === true) {\n            return;\n        }\n        const scheduler = this.scheduler;\n        let message = new DelayMessage(scheduler.now() + this.delay, notification);\n        this.queue.push(message);\n        if (this.active === false) {\n            this._schedule(scheduler);\n        }\n    }\n    _next(value) {\n        this.scheduleNotification(Notification.createNext(value));\n    }\n    _error(err) {\n        this.errored = true;\n        this.queue = [];\n        this.destination.error(err);\n    }\n    _complete() {\n        this.scheduleNotification(Notification.createComplete());\n    }\n}\nclass DelayMessage {\n    constructor(time, notification) {\n        this.time = time;\n        this.notification = notification;\n    }\n}\n//# sourceMappingURL=delay.js.map"]}