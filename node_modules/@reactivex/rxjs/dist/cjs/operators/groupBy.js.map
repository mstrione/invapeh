{"version":3,"sources":["../../es6/operators/groupBy.js"],"names":[],"mappings":"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","file":"groupBy.js","sourcesContent":["import Subscriber from '../Subscriber';\nimport Observable from '../Observable';\nimport Subject from '../Subject';\nimport Map from '../util/Map';\nimport FastMap from '../util/FastMap';\nimport { RefCountSubscription, GroupedObservable } from './groupBy-support';\nimport tryCatch from '../util/tryCatch';\nimport { errorObject } from '../util/errorObject';\nexport function groupBy(keySelector, elementSelector, durationSelector) {\n    return new GroupByObservable(this, keySelector, elementSelector, durationSelector);\n}\nexport class GroupByObservable extends Observable {\n    constructor(source, keySelector, elementSelector, durationSelector) {\n        super();\n        this.source = source;\n        this.keySelector = keySelector;\n        this.elementSelector = elementSelector;\n        this.durationSelector = durationSelector;\n    }\n    _subscribe(subscriber) {\n        const refCountSubscription = new RefCountSubscription();\n        const groupBySubscriber = new GroupBySubscriber(subscriber, refCountSubscription, this.keySelector, this.elementSelector, this.durationSelector);\n        refCountSubscription.setPrimary(this.source.subscribe(groupBySubscriber));\n        return refCountSubscription;\n    }\n}\nclass GroupBySubscriber extends Subscriber {\n    constructor(destination, refCountSubscription, keySelector, elementSelector, durationSelector) {\n        super();\n        this.refCountSubscription = refCountSubscription;\n        this.keySelector = keySelector;\n        this.elementSelector = elementSelector;\n        this.durationSelector = durationSelector;\n        this.groups = null;\n        this.destination = destination;\n        this.add(destination);\n    }\n    _next(x) {\n        let key = tryCatch(this.keySelector)(x);\n        if (key === errorObject) {\n            this.error(key.e);\n        }\n        else {\n            let groups = this.groups;\n            const elementSelector = this.elementSelector;\n            const durationSelector = this.durationSelector;\n            if (!groups) {\n                groups = this.groups = typeof key === 'string' ? new FastMap() : new Map();\n            }\n            let group = groups.get(key);\n            if (!group) {\n                groups.set(key, group = new Subject());\n                let groupedObservable = new GroupedObservable(key, group, this.refCountSubscription);\n                if (durationSelector) {\n                    let duration = tryCatch(durationSelector)(new GroupedObservable(key, group));\n                    if (duration === errorObject) {\n                        this.error(duration.e);\n                    }\n                    else {\n                        this.add(duration._subscribe(new GroupDurationSubscriber(key, group, this)));\n                    }\n                }\n                this.destination.next(groupedObservable);\n            }\n            if (elementSelector) {\n                let value = tryCatch(elementSelector)(x);\n                if (value === errorObject) {\n                    this.error(value.e);\n                }\n                else {\n                    group.next(value);\n                }\n            }\n            else {\n                group.next(x);\n            }\n        }\n    }\n    _error(err) {\n        const groups = this.groups;\n        if (groups) {\n            groups.forEach((group, key) => {\n                group.error(err);\n                this.removeGroup(key);\n            });\n        }\n        this.destination.error(err);\n    }\n    _complete() {\n        const groups = this.groups;\n        if (groups) {\n            groups.forEach((group, key) => {\n                group.complete();\n                this.removeGroup(group);\n            });\n        }\n        this.destination.complete();\n    }\n    removeGroup(key) {\n        this.groups.delete(key);\n    }\n}\nclass GroupDurationSubscriber extends Subscriber {\n    constructor(key, group, parent) {\n        super(null);\n        this.key = key;\n        this.group = group;\n        this.parent = parent;\n    }\n    _next(value) {\n        this.group.complete();\n        this.parent.removeGroup(this.key);\n    }\n    _error(err) {\n        this.group.error(err);\n        this.parent.removeGroup(this.key);\n    }\n    _complete() {\n        this.group.complete();\n        this.parent.removeGroup(this.key);\n    }\n}\n//# sourceMappingURL=groupBy.js.map"]}